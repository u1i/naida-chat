import{GoogleGenerativeAI as b}from"@google/generative-ai";var g=class{constructor(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.initialize()):this.initialize()}initialize(){this.loadSettings(),this.setupThemeToggle(),this.setupSettingsPanel()}loadSettings(){this.apiKey=localStorage.getItem("apiKey")||"",this.temperature=parseFloat(localStorage.getItem("temperature"))||1,this.systemPrompt=localStorage.getItem("systemPrompt")||"You are a helpful assistant.",this.theme=localStorage.getItem("theme")||"light",document.getElementById("apiKey").value=this.apiKey,document.getElementById("temperature").value=this.temperature,document.getElementById("temperatureValue").textContent=this.temperature,document.getElementById("systemPrompt").value=this.systemPrompt,document.documentElement.setAttribute("data-theme",this.theme)}setupThemeToggle(){let e=document.getElementById("themeToggle"),t=e.querySelector("i");e.addEventListener("click",()=>{let s=this.theme==="light"?"dark":"light";this.theme=s,document.documentElement.setAttribute("data-theme",s),t.className=`ri-${s==="light"?"sun":"moon"}-line`,localStorage.setItem("theme",s)})}setupSettingsPanel(){let e=document.querySelector("#settingsBtn"),t=document.querySelector("#settingsPanel"),s=document.querySelector("#settingsClose"),n=document.querySelector("#settingsClose i"),o=document.querySelector("#settingsOverlay");function r(){t.classList.add("hidden"),o.classList.add("hidden")}function l(){t.classList.remove("hidden"),o.classList.remove("hidden")}e.addEventListener("click",l),s.addEventListener("click",r,!0),n.addEventListener("click",r,!0),o.addEventListener("click",r),document.addEventListener("keydown",d=>{d.key==="Escape"&&r()});let u=document.querySelector("#temperature"),E=document.querySelector("#temperatureValue"),K=document.querySelector("#apiKey"),H=document.querySelector("#systemPrompt");u.addEventListener("input",d=>{let w=parseFloat(d.target.value);E.textContent=w.toFixed(1),this.temperature=w,localStorage.setItem("temperature",w)}),K.addEventListener("change",d=>{this.apiKey=d.target.value,localStorage.setItem("apiKey",d.target.value)}),H.addEventListener("change",d=>{this.systemPrompt=d.target.value,localStorage.setItem("systemPrompt",d.target.value)})}getSettings(){return{apiKey:this.apiKey,temperature:this.temperature,systemPrompt:this.systemPrompt}}};var p=class{constructor(e,t){this.chatManager=e,this.settings=t,this.messageInput=document.getElementById("messageInput"),this.sendButton=document.getElementById("sendButton"),this.newChatButton=document.getElementById("newChatButton"),this.chatMessages=document.getElementById("chatMessages"),this.isProcessing=!1}initialize(){this.setupEventListeners()}setupEventListeners(){this.sendButton.addEventListener("click",()=>this.sendMessage()),this.newChatButton.addEventListener("click",()=>this.startNewChat()),this.messageInput.addEventListener("keydown",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.sendMessage())})}async sendMessage(){if(this.isProcessing||!this.messageInput.value.trim())return;let e=this.messageInput.value.trim();this.isProcessing=!0,this.messageInput.disabled=!0,this.messageInput.value="",this.messageInput.style.height="auto",this.sendButton.disabled=!0,this.addMessageToUI("user",e);let t=this.addTypingIndicator();try{let s=await this.chatManager.sendMessage(e);t.remove(),this.addMessageToUI("bot",s)}catch(s){t.remove(),this.addErrorMessage(s.message)}finally{this.isProcessing=!1,this.messageInput.disabled=!1,this.sendButton.disabled=!1,this.chatMessages.scrollTop=this.chatMessages.scrollHeight,this.messageInput.focus()}}addMessageToUI(e,t){let s=document.createElement("div");s.className=`message ${e}-message`,s.textContent=t,this.chatMessages.appendChild(s),this.chatMessages.scrollTop=this.chatMessages.scrollHeight}addTypingIndicator(){let e=document.createElement("div");return e.className="message bot-message typing-indicator",e.innerHTML="<span></span><span></span><span></span>",this.chatMessages.appendChild(e),this.chatMessages.scrollTop=this.chatMessages.scrollHeight,e}addErrorMessage(e){let t=document.createElement("div");t.className="message error-message",t.textContent=`Error: ${e}`,this.chatMessages.appendChild(t)}startNewChat(){this.chatMessages.innerHTML="",this.chatManager.clearChat()}};import{GoogleGenerativeAI as N}from"@google/generative-ai";var y=class{constructor(e){this.settings=e,this.chatHistory=[],this.chatSession=null}async initializeChat(){let{apiKey:e,temperature:t,systemPrompt:s}=this.settings.getSettings();if(!e)throw new Error("Please enter your API key in settings (gear icon)");let o=new N(e).getGenerativeModel({model:"gemini-1.5-flash",systemInstruction:s}),r={temperature:t,topP:.95,topK:40,maxOutputTokens:8192,responseMimeType:"text/plain"};this.chatSession=o.startChat({generationConfig:r,history:this.chatHistory})}async sendMessage(e,t=0){this.chatSession||await this.initializeChat();try{let n=(await this.chatSession.sendMessage(e)).response.text();return this.chatHistory.push({role:"user",parts:[{text:e}]},{role:"model",parts:[{text:n}]}),n}catch(s){console.error("Error sending message:",s);let n=s.message?.includes("429")||s.message?.includes("Resource has been exhausted")||s.status===429;if(n&&t<3)return console.log(`Rate limit hit, retrying in 10 seconds... (Attempt ${t+1}/3)`),await new Promise(o=>setTimeout(o,1e4)),this.sendMessage(e,t+1);throw n?new Error("The AI service is currently busy. Please try again in a few minutes."):new Error(s.message||"An error occurred while sending the message.")}}clearChat(){this.chatHistory=[],this.chatSession=null}};import{marked as B}from"https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js";var v=class{constructor(){this.contents={help:"",privacy:""},this.currentDoc="help",this.docsPath="./docs/",document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.initialize()):this.initialize()}async initialize(){let e=document.getElementById("helpBtn"),t=document.getElementById("helpPanel"),s=document.getElementById("helpOverlay"),n=t.querySelector(".help-content");await Promise.all([this.loadContent("help"),this.loadContent("privacy")]),e.addEventListener("click",()=>{t.classList.remove("hidden"),s.classList.remove("hidden"),n.innerHTML=B.parse(this.contents[this.currentDoc])}),n.insertAdjacentHTML("beforebegin",`
            <div class="help-tabs">
                <button class="help-tab active" data-doc="help">Help & FAQ</button>
                <button class="help-tab" data-doc="privacy">Privacy Policy</button>
            </div>
        `);let r=t.querySelectorAll(".help-tab");r.forEach(l=>{l.addEventListener("click",()=>{r.forEach(E=>E.classList.remove("active")),l.classList.add("active");let u=l.dataset.doc;this.currentDoc=u,n.innerHTML=B.parse(this.contents[u])})})}async loadContent(e){try{let t=await fetch(`${this.docsPath}${e}.md`);if(!t.ok)throw new Error(`Failed to load ${e} content`);this.contents[e]=await t.text()}catch(t){console.error("Error loading help content:",t),this.contents[e]=`# Error
Failed to load content. Please try again later.`}}};var I=document.getElementById("messageInput"),S=document.getElementById("sendButton"),O=document.getElementById("newChatButton"),c=document.getElementById("chatMessages"),ee=document.getElementById("settingsBtn"),te=document.getElementById("settingsPanel"),se=document.getElementById("settingsOverlay"),C=document.getElementById("themeToggle"),m=document.getElementById("apiKey"),P=document.getElementById("temperature"),A=document.getElementById("temperatureValue"),h=document.getElementById("systemPrompt"),i=document.getElementById("testApiKey"),L=document.getElementById("modelSelect"),f=null,M=!1,ne=new g,q=new p,ae=new y(q),oe=new v;document.addEventListener("DOMContentLoaded",()=>{z(),D()});function D(){I.addEventListener("keydown",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),k())}),S.addEventListener("click",k),O.addEventListener("click",()=>{c.innerHTML="",f=null});let a=document.getElementById("helpBtn"),e=document.getElementById("helpPanel"),t=document.getElementById("helpClose"),s=document.getElementById("helpOverlay");a.onclick=()=>{e.classList.remove("hidden"),s.classList.remove("hidden")},t.onclick=()=>{e.classList.add("hidden"),s.classList.add("hidden")},s.onclick=()=>{e.classList.add("hidden"),s.classList.add("hidden")},i.onclick=async()=>{let n=m.value.trim();if(!n){alert("Please enter an API key first");return}i.classList.add("loading"),i.textContent="Testing...",i.disabled=!0;try{await new b(n).getGenerativeModel({model:"gemini-1.5-flash"}).generateContent('Test message. Please respond with "OK" if you receive this.');let l=await $(n);x(l),localStorage.setItem("availableModels",JSON.stringify(l)),localStorage.setItem("apiKey",n),i.classList.remove("loading"),i.classList.add("success"),i.textContent="\u2713 API Key Valid",setTimeout(()=>{i.classList.remove("success"),i.textContent="Test API Key",i.disabled=!1},2e3)}catch(o){console.error("API Key test failed:",o),i.classList.remove("loading"),i.classList.add("error"),i.textContent="\u2715 Invalid API Key",setTimeout(()=>{i.classList.remove("error"),i.textContent="Test API Key",i.disabled=!1},2e3)}},C.onclick=()=>{let o=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",o),localStorage.setItem("theme",o),C.innerHTML=`<i class="ri-${o==="light"?"sun":"moon"}-line"></i>`},m.onchange=()=>localStorage.setItem("apiKey",m.value),P.oninput=n=>{let o=n.target.value;A.textContent=o,localStorage.setItem("temperature",o)},h.onchange=()=>{localStorage.setItem("systemPrompt",h.value),c.querySelectorAll(".message:not(.welcome-message):not(.system-message)").length>0&&alert('Note: The new system prompt will only take effect when you start a new chat session. Click "New Chat" to start fresh with the new prompt.')},L.onchange=()=>{localStorage.setItem("selectedModel",L.value),c.querySelectorAll(".message:not(.welcome-message):not(.system-message)").length>0&&alert('Note: The new model selection will only take effect when you start a new chat session. Click "New Chat" to start fresh with the new model.')}}async function $(a){let e=await fetch("https://generativelanguage.googleapis.com/v1/models",{headers:{"x-goog-api-key":a}});if(!e.ok)throw new Error("Failed to fetch models");return(await e.json()).models.filter(s=>!s.name.includes("embedding")&&s.supportedGenerationMethods.includes("generateContent")).sort((s,n)=>s.displayName.localeCompare(n.displayName))}function x(a){let e=document.getElementById("modelSelect");e.innerHTML="",a.forEach(s=>{let n=document.createElement("option");n.value=s.name.replace("models/",""),n.textContent=s.displayName,e.appendChild(n)});let t=Array.from(e.options).find(s=>s.value==="gemini-1.5-flash");t&&(t.selected=!0,localStorage.setItem("selectedModel","gemini-1.5-flash"))}function z(){let a=localStorage.getItem("apiKey")||"";m.value=a;let e=localStorage.getItem("temperature")||"1.0";P.value=e,A.textContent=e;let s=localStorage.getItem("systemPrompt")||"You are a super duper assistant";h.value=s;let n=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",n),C.innerHTML=`<i class="ri-${n==="light"?"sun":"moon"}-line"></i>`;let o=localStorage.getItem("availableModels");if(o){let l=JSON.parse(o);x(l)}let r=localStorage.getItem("selectedModel");if(r){let l=document.getElementById("modelSelect");l.value=r}}async function F(){let a=m.value;if(!a)throw new Error("Please enter your API key in settings (gear icon)");let e=new b(a),t=L.value,s=e.getGenerativeModel({model:t}),n={temperature:parseFloat(P.value),topP:.95,topK:40,maxOutputTokens:8192};return s.startChat({generationConfig:n,history:[{role:"user",parts:[{text:"From now on, you must follow this system prompt: "+h.value}]},{role:"model",parts:[{text:"I understand and will follow the system prompt: "+h.value}]}]})}function T(a,e){let t=document.createElement("div");t.className=`message ${a}-message`,t.textContent=e,c.appendChild(t),c.scrollTop=c.scrollHeight}function G(){let a=document.createElement("div");return a.className="message bot-message typing-indicator",a.innerHTML="<span></span><span></span><span></span>",c.appendChild(a),c.scrollTop=c.scrollHeight,a}async function k(){if(M||!I.value.trim())return;let a=I.value.trim();I.value="",T("user",a);try{M=!0,S.disabled=!0,f||(f=await F());let e=G(),s=(await f.sendMessage(a)).response.text();e.remove(),T("bot",s)}catch(e){let t=document.createElement("div");t.className="message error-message",t.textContent=`Error: ${e.message}`,c.appendChild(t)}finally{M=!1,S.disabled=!1,c.scrollTop=c.scrollHeight}}
//# sourceMappingURL=app.js.map
