import{GoogleGenerativeAI as L}from"@google/generative-ai";var u=document.getElementById("messageInput"),y=document.getElementById("sendButton"),B=document.getElementById("newChatButton"),a=document.getElementById("chatMessages"),r=document.getElementById("settingsBtn"),d=document.getElementById("settingsPanel"),m=document.getElementById("settingsOverlay"),v=document.getElementById("themeToggle"),c=document.getElementById("apiKey"),I=document.getElementById("temperature"),T=document.getElementById("temperatureValue"),i=document.getElementById("systemPrompt"),o=document.getElementById("testApiKey"),f=document.getElementById("modelSelect"),g=null,h=!1;document.addEventListener("DOMContentLoaded",()=>{k(),A()});function A(){r.onclick=()=>{r.classList.toggle("active"),d.classList.toggle("hidden"),m.classList.toggle("hidden")},m.onclick=()=>{r.classList.remove("active"),d.classList.add("hidden"),m.classList.add("hidden")},document.addEventListener("keydown",e=>{e.key==="Escape"&&!d.classList.contains("hidden")&&(r.classList.remove("active"),d.classList.add("hidden"),m.classList.add("hidden"))}),o.onclick=async()=>{let e=c.value.trim();if(!e){alert("Please enter an API key first");return}o.classList.add("loading"),o.textContent="Testing...",o.disabled=!0;try{await new L(e).getGenerativeModel({model:"gemini-1.5-flash"}).generateContent('Test message. Please respond with "OK" if you receive this.');let s=await P(e);M(s),localStorage.setItem("availableModels",JSON.stringify(s)),localStorage.setItem("apiKey",e),o.classList.remove("loading"),o.classList.add("success"),o.textContent="\u2713 API Key Valid",setTimeout(()=>{o.classList.remove("success"),o.textContent="Test API Key",o.disabled=!1},2e3)}catch(t){console.error("API Key test failed:",t),o.classList.remove("loading"),o.classList.add("error"),o.textContent="\u2715 Invalid API Key",setTimeout(()=>{o.classList.remove("error"),o.textContent="Test API Key",o.disabled=!1},2e3)}},v.onclick=()=>{let t=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),v.innerHTML=`<i class="ri-${t==="light"?"sun":"moon"}-line"></i>`},y.onclick=S,u.onkeydown=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),S())},B.onclick=()=>{a.innerHTML="",g=null},c.onchange=()=>localStorage.setItem("apiKey",c.value),I.oninput=e=>{let t=e.target.value;T.textContent=t,localStorage.setItem("temperature",t)},i.onchange=()=>{localStorage.setItem("systemPrompt",i.value),a.querySelectorAll(".message:not(.welcome-message):not(.system-message)").length>0&&alert('Note: The new system prompt will only take effect when you start a new chat session. Click "New Chat" to start fresh with the new prompt.')},f.onchange=()=>{localStorage.setItem("selectedModel",f.value),a.querySelectorAll(".message:not(.welcome-message):not(.system-message)").length>0&&alert('Note: The new model selection will only take effect when you start a new chat session. Click "New Chat" to start fresh with the new model.')}}async function P(e){let t=await fetch("https://generativelanguage.googleapis.com/v1/models",{headers:{"x-goog-api-key":e}});if(!t.ok)throw new Error("Failed to fetch models");return(await t.json()).models.filter(s=>!s.name.includes("embedding")&&s.supportedGenerationMethods.includes("generateContent")).sort((s,l)=>s.displayName.localeCompare(l.displayName))}function M(e){let t=document.getElementById("modelSelect");t.innerHTML="",e.forEach(s=>{let l=document.createElement("option");l.value=s.name.replace("models/",""),l.textContent=s.displayName,t.appendChild(l)});let n=Array.from(t.options).find(s=>s.value==="gemini-1.5-flash");n&&(n.selected=!0,localStorage.setItem("selectedModel","gemini-1.5-flash"))}function k(){let e=localStorage.getItem("apiKey")||"";c.value=e;let t=localStorage.getItem("temperature")||"1.0";I.value=t,T.textContent=t;let s=localStorage.getItem("systemPrompt")||"You are a super duper assistant";i.value=s;let l=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",l),v.innerHTML=`<i class="ri-${l==="light"?"sun":"moon"}-line"></i>`;let w=localStorage.getItem("availableModels");if(w){let p=JSON.parse(w);M(p)}let E=localStorage.getItem("selectedModel");if(E){let p=document.getElementById("modelSelect");p.value=E}}async function K(){let e=c.value;if(!e)throw new Error("Please enter your API key in settings (gear icon)");let t=new L(e),n=f.value,s=t.getGenerativeModel({model:n}),l={temperature:parseFloat(I.value),topP:.95,topK:40,maxOutputTokens:8192};return s.startChat({generationConfig:l,history:[{role:"user",parts:[{text:"From now on, you must follow this system prompt: "+i.value}]},{role:"model",parts:[{text:"I understand and will follow the system prompt: "+i.value}]}]})}function C(e,t){let n=document.createElement("div");n.className=`message ${e}-message`,n.textContent=t,a.appendChild(n),a.scrollTop=a.scrollHeight}function x(){let e=document.createElement("div");return e.className="message bot-message typing-indicator",e.innerHTML="<span></span><span></span><span></span>",a.appendChild(e),a.scrollTop=a.scrollHeight,e}async function S(){if(h||!u.value.trim())return;let e=u.value.trim();u.value="",C("user",e);try{h=!0,y.disabled=!0,g||(g=await K());let t=x(),s=(await g.sendMessage(e)).response.text();t.remove(),C("bot",s)}catch(t){let n=document.createElement("div");n.className="message error-message",n.textContent=`Error: ${t.message}`,a.appendChild(n)}finally{h=!1,y.disabled=!1,a.scrollTop=a.scrollHeight}}
//# sourceMappingURL=app.js.map
